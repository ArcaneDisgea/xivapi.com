{% extends "docs/index.html.twig"  %}
{% import "docs/macros.html.twig" as docs %}
{% set section = 14 %}

{% block doc %}

    <h1>Market</h1>

    <p>
        Get in-game market board information for any server, at any time.
    </p>
    <p>
        Market data is tracked and updated behind the scenes and stored in ElasticSearch. This provides you
        with fast access to all Market Data on any server.
    </p>

    <h6>Notice of usage</h6>

    <p class="note">
        <strong>No Scraping</strong>
        <br>
        If you want a lot of market data for research, please hop on Discord and talk to Vekien. Scraping will just
        get you automatically banned from the API. Alternatively, you can look into building your own Companion API tool
        and obtain the data from SE directly, <a href="https://github.com/viion/ffxiv-datamining/blob/master/docs/CompanionAppApi.md">you can find more here</a>.

        <br><br>

        <strong>Spam</strong>
        <br>
        Don't spam the API, this accounts for the entire API (not just /market). Other users are using this API
        and spamming it with a bunch of requests (even within your Rate Limit) could get you banned. Just because
        you have 10/sec doesn't mean you should be doing 10/sec 24/7/365...

        <br><br>

        <strong>Some servers are not supported</strong>
        <br>
        Due to world congestion, some servers are not on the API at this time. Please view the full supported servers at the bottom.
    </p>

    <h2>Documentation Work-In-Progress</h2>
    <p>
        The Market API is not fully documented at this time.
    </p>

    <hr>

    {# Item on Server #}
    {{ docs.api('/market/[server]/item/[item_id]', '/market/Phoenix/item/3', 'market') }}
    <p>
        Obtain the <strong>prices &amp; history</strong> for an item on a specific server.
    </p>

    <table class="param-table">
        <thead>
        <tr>
            <th width="25%">Param</th>
            <th width="75%">Description</th>
        </tr>
        </thead>
        <tbody>
            <tr>
                <td>max_history</td>
                <td>Limit the number of history results returned.</td>
            </tr>
        </tbody>
    </table>

    <br><br>

    {# Item on any server or dc #}
    {{ docs.api('/market/item/[item_id]?servers=[x,y,z]', '/market/item/3?servers=Phoenix,Lich,Moogle', 'multi') }}
    <p>
        Obtain the <strong>prices &amp; history</strong> for an item on multiple servers or an entire Data-Center.
    </p>

    <table class="param-table">
        <thead>
        <tr>
            <th width="25%">Param</th>
            <th width="75%">Description</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>servers</td>
            <td>A comma seperated listed of servers.</td>
        </tr>
        <tr>
            <td>dc</td>
            <td>A Data-Center name, all servers in that DC will be returned, eg: <code>?dc=Chaos</code>.</td>
        </tr>
        <tr>
            <td>max_history</td>
            <td>Limit the number of history results returned.</td>
        </tr>
        </tbody>
    </table>

    <br><br>

    {# Categories #}
    {{ docs.api('/market/categories', '/market/categories', 'categories') }}
    <p>
        Get a list of market Search Categories.
    </p>

    <br><br>

    {# Search #}
    {{ docs.api('/market/search', '/market/search', 'search') }}
    <p>
        Work In Progress! Soon(tm)
    </p>

    <hr>

    <h2>Server Status</h2>

    <p>
        At this time the following servers are not supported due to world congestion:
        <code>{{ server_unsupported|join(', ', ' and ') }}</code> - Server Offline are likely
        due to login issues and will be re-attempted every hour.
    </p>

    <table class="param-table">
        <thead>
        <tr>
            <th width="40%">Server</th>
            <th>Status</th>
            <th>Last Checked</th>
        </tr>
        </thead>
        <tbody>
        {% for token in server_tokens %}
            <tr>
                <td>{{ token.server }}</td>
                <td>{{ token.online ? 'Market Online' : '‼️ OFFLINE' }}</td>
                <td>{{ token.lastOnline|date }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

{% endblock %}
