{% extends "docs/index.html.twig"  %}
{% import "docs/macros.html.twig" as docs %}
{% set section = 14 %}

{% block doc %}

    <h1>Market</h1>

    <p>Get in-game market board information for any server, at any time.</p>
    <p>
        If you need any help, please hop on <strong>Discord</strong>:
        <a href="https://discord.gg/MFFVHWC">https://discord.gg/MFFVHWC</a>
    </p>
    <p>
        <a href="http://xivapi.com/docs/Market#section-5">View Server Status</a>
    </p>

    <br>

    <h6>Notice of usage</h6>

    <p class="note">
        <strong>No Scraping</strong>
        <br>
        If you want a lot of market data for research, please hop on Discord and talk to Vekien. Scraping will just
        get you automatically banned from the API. Alternatively, you can look into building your own Companion API tool
        and obtain the data from SE directly, <a href="https://github.com/viion/ffxiv-datamining/blob/master/docs/CompanionAppApi.md">you can find more here</a>.
    </p>

    <p class="note">
        <strong>Spam</strong>
        <br>
        Don't spam the API, this accounts for the entire API (not just /market). Other users are using this API
        and spamming it with a bunch of requests (even within your Rate Limit) could get you banned. Just because
        you have 10/sec doesn't mean you should be doing 10/sec 24/7/365...
    </p>

    <p class="note">
        <strong>Some servers are not supported</strong>
        <br>
        Due to world congestion, some servers are not on the API at this time. Please view the full supported servers at the bottom.
    </p>

    {{ docs.gap() }}

    {# GET #}
    {{ docs.api('/market/[server]/items/[item_id]', '/market/phoenix/items/5', 'prices') }}
    <p>
        A list of prices for an item on a specific server.
    </p>
    <p>
        (response info)
    </p>

    {{ docs.gap() }}

    {# History #}
    {{ docs.api('/market/[server]/items/[item_id]/history', '/market/phoenix/items/5/history', 'history') }}
    <p>
        Get the price history for an item on a specific server.
    </p>
    <p>
        (response info)
    </p>

    {{ docs.gap() }}

    {# Category stock #}
    {{ docs.api('/market/[server]/category/[category_id]', '/market/phoenix/category/10', 'stock') }}
    <p>
        Get the list of items and their sale quantity in this category.
    </p>
    <p>
        (response info)
    </p>

    {{ docs.gap() }}

    {# Market Categories #}
    {{ docs.api('/market/categories', '/market/categories', 'categories') }}
    <p>
        Get a list of market categories, this is the ID used in the endpoint:
        `/market/[server]/category/[category_id]`
    </p>

    <hr>

    {# Server Status #}
    <h4 id="status">Market Server Status</h4>
    <p>
        Below is a table of each server and their market accessibility status. If your server is
        "offline" it may mean that the server is congested and new characters cannot be made or the
        companion API is having issues accessing the Data Center where the server is based.
    </p>

    <p>At this time the following servers are not supported due to world congestion: {{ server_unsupported|join(', ', ' and ') }}</p>

    <table class="param-table">
        <thead>
        <tr>
            <th width="20%">Server</th>
            <th>Status</th>
        </tr>
        </thead>
        <tbody>
        {% for token in server_tokens %}
            <tr>
                <td>{{ token.server }}</td>
                <td>{{ token.online ? 'Market Online' : 'OFFLINE' }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

{% endblock %}
